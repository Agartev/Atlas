name: Sync Bitbucket to GitLab
on:
  workflow_dispatch:
#on:
 # repository_dispatch:
  #types: [bitbucket_push]

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v3
        with:
          repository: https://bitbucket.org/agartev/atlas.git
          token: ATCTT3xFfGN0S206Uy5hxJzgCBf-mEoRRi8SGbY_3itpo8DeVh3vJT_NS0KNszi2zUDWbhIa88DgtnZJtTNiAYJTome5Ncl991lpFxbach72ctPBZZrw0g0pPgNKSkMrOQYvtTSe7uoj3K0MiNmr7tnhAVpvwl2fsg12H1t5sgFjqjvsuI96-Q0=A9844EB9
      - name: Sync to GitLab
        run: |
          git remote add gitlab https://gitlab.com/Agartev/atlas.git
          git push gitlab main

      - name: Check if GitLab Repository is Empty
        id: check_empty
        run: |
          if [ "$(git ls-remote --heads gitlab main)" ]; then
            echo "GitLab repository is not empty."
            echo "empty=false" >> $GITHUB_ENV
          else
            echo "GitLab repository is empty."
            echo "empty=true" >> $GITHUB_ENV
          fi

      - name: Push to GitLab if Not Empty
        if: env.empty == 'false'
        run: |
          git push gitlab main

      - name: Initialize and Push to GitLab if Empty
        if: env.empty == 'true'
        run: |
          git checkout -b main
          git add .
          git commit -m "Initial commit"
          git push gitlab main
